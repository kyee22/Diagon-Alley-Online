<h1>我的购物车</h1>
<p style="color: green"><%= notice %></p>

<ul>
  <% @cart_items.each do |cart_item| %>
    <li>
      <%= cart_item.product.name %> -
      <%= cart_item.quantity %> 个 -
      <%= cart_item.total_price %> 元
      <strong>加入时间：</strong><%= cart_item.added_at.strftime("%Y-%m-%d %H:%M:%S") %>
      <%= button_to '移除', cart_item_path(cart_item), method: :delete %>

      <%= form_with(model: cart_item, url: cart_item_path(cart_item), method: :put) do |form| %>
        <%= form.number_field :quantity, value: cart_item.quantity, min: 1 %>
        <%= form.submit '更新数量' %>
      <% end %>
    </li>
  <% end %>

  <%= form_with url: orders_path, method: :post do |form| %>
    <label>选择收货地址：</label>
    <%= select_tag :delivery_address_id, options_from_collection_for_select(current_user.delivery_addresses, :id, :address) %>
    <%= form.submit '生成订单', class: 'btn btn-success' %>
  <% end %>
</ul>

<%= link_to '继续购物', products_path %>
